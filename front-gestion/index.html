<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prueba de API - Academias, Grupos, Alumnos y Profesores</title>
    <style>
        body { font-family: Arial, sans-serif; }
        .container { max-width: 500px; margin: 50px auto; }
        .input-group { margin-bottom: 15px; }
        label { display: block; font-weight: bold; }
        input, button { width: 100%; padding: 8px; margin-top: 5px; }
        button { background-color: #4CAF50; color: white; border: none; cursor: pointer; }
        button:hover { background-color: #45a049; }
        .response { margin-top: 20px; padding: 10px; border: 1px solid #ccc; }
    </style>
</head>
<body>

<div class="container">
    <h2>Prueba de API - Academias, Grupos, Alumnos y Profesores</h2>

    <!-- Formulario de inicio de sesión -->
    <div class="input-group">
        <label for="login-identifier">Identificador</label>
        <input type="text" id="login-identifier">
    </div>
    <div class="input-group">
        <label for="login-password">Contraseña</label>
        <input type="password" id="login-password">
    </div>
    <button onclick="login()">Iniciar Sesión</button>

    <!-- Crear Academia -->
    <h3>Crear Academia</h3>
    <div class="input-group">
        <label for="academy-name">Nombre de la Academia</label>
        <input type="text" id="academy-name">
    </div>
    <div class="input-group">
        <label for="main-teacher-rfc">RFC del Profesor Principal</label>
        <input type="text" id="main-teacher-rfc">
    </div>
    <button onclick="createAcademy()">Crear Academia</button>
    <button onclick="getAcademies()">Obtener Todas las Academias</button>

    <!-- Crear Grupo -->
    <h3>Crear Grupo</h3>
    <div class="input-group">
        <label for="group-name">Nombre del Grupo</label>
        <input type="text" id="group-name">
    </div>
    <div class="input-group">
        <label for="semester-id">ID del Semestre</label>
        <input type="number" id="semester-id">
    </div>
    <button onclick="createGroup()">Crear Grupo</button>
    <button onclick="getGroups()">Obtener Todos los Grupos</button>

    <!-- Crear Alumno -->
    <h3>Crear Alumno</h3>
    <div class="input-group">
        <label for="student-username">Nombre de Usuario</label>
        <input type="text" id="student-username">
    </div>
    <div class="input-group">
        <label for="student-email">Email</label>
        <input type="email" id="student-email">
    </div>
    <div class="input-group">
        <label for="student-password">Contraseña</label>
        <input type="password" id="student-password">
    </div>
    <div class="input-group">
        <label for="student-boleta">Boleta</label>
        <input type="text" id="student-boleta">
    </div>
    <button onclick="createStudent()">Crear Alumno</button>
    <button onclick="getStudents()">Obtener Todos los Alumnos</button>

    <!-- Crear Profesor -->
    <h3>Crear Profesor</h3>
    <div class="input-group">
        <label for="teacher-username">Nombre de Usuario</label>
        <input type="text" id="teacher-username">
    </div>
    <div class="input-group">
        <label for="teacher-email">Email</label>
        <input type="email" id="teacher-email">
    </div>
    <div class="input-group">
        <label for="teacher-password">Contraseña</label>
        <input type="password" id="teacher-password">
    </div>
    <div class="input-group">
        <label for="teacher-rfc">RFC</label>
        <input type="text" id="teacher-rfc">
    </div>
    <button onclick="createTeacher()">Crear Profesor</button>
    <button onclick="getTeachers()">Obtener Todos los Profesores</button>

    <!-- Mostrar respuesta -->
    <div id="response" class="response"></div>
</div>

<script>
    let accessToken = "";

    // Función de inicio de sesión
    async function login() {
        const identifier = document.getElementById('login-identifier').value;
        const password = document.getElementById('login-password').value;
        const response = await fetch('http://localhost:5000/auth/login', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ identifier, password })
        });
        const data = await response.json();
        document.getElementById('response').innerText = JSON.stringify(data, null, 2);

        if (response.ok) {
            accessToken = data.access_token;
        }
    }

    // Crear academia
    async function createAcademy() {
        const name = document.getElementById('academy-name').value;
        const mainTeacherRFC = document.getElementById('main-teacher-rfc').value;

        const response = await fetch('http://localhost:5000/users/academies', {
            method: 'POST',
            headers: { 
                'Content-Type': 'application/json',
                'Authorization': 'Bearer ' + accessToken 
            },
            body: JSON.stringify({
                name: name,
                main_teacher_rfc: mainTeacherRFC
            })
        });

        const data = await response.json();
        document.getElementById('response').innerText = JSON.stringify(data, null, 2);
    }

    // Obtener todas las academias
    async function getAcademies() {
        const response = await fetch('http://localhost:5000/users/academies', {
            method: 'GET',
            headers: { 'Authorization': 'Bearer ' + accessToken }
        });

        const data = await response.json();
        document.getElementById('response').innerText = JSON.stringify(data, null, 2);
    }

    // Crear grupo
    async function createGroup() {
        const name = document.getElementById('group-name').value;
        const semesterId = document.getElementById('semester-id').value;

        const response = await fetch('http://localhost:5000/groups/create-group', {
            method: 'POST',
            headers: { 
                'Content-Type': 'application/json',
                'Authorization': 'Bearer ' + accessToken 
            },
            body: JSON.stringify({
                name: name,
                semester_id: parseInt(semesterId)
            })
        });

        const data = await response.json();
        document.getElementById('response').innerText = JSON.stringify(data, null, 2);
    }

    // Obtener todos los grupos
    async function getGroups() {
        const response = await fetch('http://localhost:5000/groups', {
            method: 'GET',
            headers: { 'Authorization': 'Bearer ' + accessToken }
        });

        const data = await response.json();
        document.getElementById('response').innerText = JSON.stringify(data, null, 2);
    }

    // Crear alumno
    async function createStudent() {
        const username = document.getElementById('student-username').value;
        const email = document.getElementById('student-email').value;
        const password = document.getElementById('student-password').value;
        const boleta = document.getElementById('student-boleta').value;

        const response = await fetch('http://localhost:5000/users/', {
            method: 'POST',
            headers: { 
                'Content-Type': 'application/json',
                'Authorization': 'Bearer ' + accessToken 
            },
            body: JSON.stringify({
                username: username,
                email: email,
                password: password,
                role_id: 3,  // Role_id para estudiantes
                boleta: boleta
            })
        });

        const data = await response.json();
        document.getElementById('response').innerText = JSON.stringify(data, null, 2);
    }

    // Obtener todos los alumnos
    async function getStudents() {
        const response = await fetch('http://localhost:5000/users/?role=3', { // Filtrado por rol estudiante
            method: 'GET',
            headers: { 'Authorization': 'Bearer ' + accessToken }
        });

        const data = await response.json();
        document.getElementById('response').innerText = JSON.stringify(data, null, 2);
    }

    // Crear profesor
    async function createTeacher() {
        const username = document.getElementById('teacher-username').value;
        const email = document.getElementById('teacher-email').value;
        const password = document.getElementById('teacher-password').value;
        const rfc = document.getElementById('teacher-rfc').value;

        const response = await fetch('http://localhost:5000/users/', {
            method: 'POST',
            headers: { 
                'Content-Type': 'application/json',
                'Authorization': 'Bearer ' + accessToken 
            },
            body: JSON.stringify({
                username: username,
                email: email,
                password: password,
                role_id: 2,  // Role_id para profesores
                rfc: rfc
            })
        });

        const data = await response.json();
        document.getElementById('response').innerText = JSON.stringify(data, null, 2);
    }

    // Obtener todos los profesores
    async function getTeachers() {
        const response = await fetch('http://localhost:5000/users/?role=2', { // Filtrado por rol profesor
            method: 'GET',
            headers: { 'Authorization': 'Bearer ' + accessToken }
        });

        const data = await response.json();
        document.getElementById('response').innerText = JSON.stringify(data, null, 2);
    }
</script>

</body>
</html>
